# # GUI App for An easy to use powerful server monitor built by [Spatie](https://github.com/spatie)

We all dream of servers that need no maintenance at all. But unfortunately in reality this is not the case. Disks can get full, processes can crash, the server can run out of memory...

This package keeps an eye on the health of all your servers. There are a few [checks that come out of the box](https://docs.spatie.be/laravel-server-monitor/v1/monitoring-basics/built-in-checks). [Adding new checks](https://docs.spatie.be/laravel-server-monitor/v1/monitoring-basics/writing-your-own-checks) is a breeze.

When something goes wrong it can [notify you](https://docs.spatie.be/laravel-server-monitor/v1/monitoring-basics/notifications-and-events) via Slack or mail. Here's how a Slack notification look like:

<img src="https://docs.spatie.be/images/server-monitor/check-failed.jpg" class="screenshot -slack">

Behind the scenes [Laravel's native notification system](https://laravel.com/docs/5.4/notifications) is leveraged so you can use one of the [many notification drivers](http://laravel-notification-channels.com/).

## Documentation

The full documentation is available on [our documentation site](https://docs.spatie.be/laravel-server-monitor).

## Installation

You can clone the repository using the below command:

```bash
git clone https://github.com/my-monitor/server-monitor.git my-server-monitor
```

this will create a directory named `my-server-monitor`, cd into it and run `composer install` command

```
cd my-server-monitor && composer install
```

After composer finish installation make your env file 

```
cp .env.example .env
```

then generate the app key
```
php artisan key:generate
```

then update your env values and setup your `Email`,`Database`,`Queue` Sections and don't forgot to add your notification settings `Slack` and `NOTIFIED_EMAILS`
```
QUEUE_DRIVER=redis
SERVER_MONITOR_SLACK_WEBHOOK_URL=

NOTIFIED_EMAILS=email1@mymonitor.example,email2@mymonitor.example
```

Then run the migration to create the `hosts`  and `checks `tables by running the migrations:

```bash
php artisan migrate
```

then you can update your config files `config/server-monitor.php`
This is the contents of the published config file:

```php
return [

    /*
     * These are the checks that can be performed on your servers. You can add your own
     * checks. The only requirement is that they should extend the
     * `Spatie\ServerMonitor\Checks\CheckDefinitions\CheckDefinition` class.
     */
    'checks' => [
        'diskspace' => Spatie\ServerMonitor\CheckDefinitions\Diskspace::class,
        'elasticsearch' => Spatie\ServerMonitor\CheckDefinitions\Elasticsearch::class,
        'memcached' => Spatie\ServerMonitor\CheckDefinitions\Memcached::class,
        'mysql' => Spatie\ServerMonitor\CheckDefinitions\MySql::class,
    ],

    /*
     * The performance of the package can be increased by allowing a high number
     * of concurrent ssh connections. Set this to a lower value if you're
     * getting weird errors running the check.
     */
    'concurrent_ssh_connections' => 5,

    /*
     * This string will be appended to the ssh command generated by the package.
     */
    'ssh_command_suffix' => '',

    /*
     * Run check every n minutes
     */
    'run_check_every' => 2,

    'notifications' => [

        'notifications' => [
            Spatie\ServerMonitor\Notifications\Notifications\CheckSucceeded::class => [],
            Spatie\ServerMonitor\Notifications\Notifications\CheckRestored::class => ['slack','mail'],
            Spatie\ServerMonitor\Notifications\Notifications\CheckWarning::class => ['slack','mail'],
            Spatie\ServerMonitor\Notifications\Notifications\CheckFailed::class => ['slack','mail'],
        ],

        /*
         * To avoid burying you in notifications, we'll only send one every given amount
         * of minutes when a check keeps emitting warning or keeps failing.
         */
        'throttle_failing_notifications_for_minutes' => 60,

        'mail' => [
            'to' => env('NOTIFIED_EMAILS'),
        ],

        'slack' => [
            'webhook_url' => env('SERVER_MONITOR_SLACK_WEBHOOK_URL'),
        ],

        /*
         * Here you can specify the notifiable to which the notifications should be sent. The default
         * notifiable will use the variables specified in this config file.
         */
        'notifiable' => \Spatie\ServerMonitor\Notifications\Notifiable::class,

        /*
         * The date format used in notifications.
         */
        'date_format' => 'd/m/Y',
    ],

    /*
     * To add or modify behaviour to the `Host` model you can specify your
     * own model here. The only requirement is that they should
     * extend the `Host` model provided by this package.
     */
    'host_model' => App\Host::class,

    /*
     * To add or modify behaviour to the `Check` model you can specify your
     * own model here. The only requirement is that they should
     * extend the `Check` model provided by this package.
     */
    'check_model' => App\Check::class,

    /*
     * Right before running a check it's process will be given to this class. Here you
     * can perform some last minute manipulations on it before it will
     * actually be run.
     *
     * This class should implement Spatie\ServerMonitor\Manipulators\Manipulator
     */
    'process_manipulator' => Spatie\ServerMonitor\Manipulators\Passthrough::class,
    
    /*
     * Thresholds for disk space's alert.
     */
    'diskspace_percentage_threshold' => [
        'warning' => 80,
        'fail' => 90,
    ],
];
```

the last thing is don't forget to setup your crontab
```
* * * * * php /path-to-project/artisan server-monitor:run-checks
```

## Usage

To start use the app open your project in browser in my case it is `https://my-server-monitor.dev` it will redirects you to login page. register a new account and do login you will find the hosts page

<img src="https://raw.githubusercontent.com/ahmedash95/server-monitor/master/storage/images/home.png">

then click on `Add Server` button on top right section

then fill the form like image below

<img src="https://raw.githubusercontent.com/ahmedash95/server-monitor/master/storage/images/add_server.png">

then click `Add` button on top right to save the server .. please make sure you connected to this server from the app server before adding it .. for more info check [This Page](https://docs.spatie.be/laravel-server-monitor/v1/monitoring-basics/managing-hosts#adding-hosts)

then you will find the server in the home page table

<img src="https://raw.githubusercontent.com/ahmedash95/server-monitor/master/storage/images/home_with_server.png">

as you can see the status has `3 Not Yet checked` that's because we didn't run the checker before now back to your terminal and run the check runner command
```
php artisan server-monitor:run-checks
```

the output will be something like below
```
Start running 3 checks...
Application 1: performing check `diskspace`...
Application 1: performing check `memoryusage`...
Application 1: performing check `cpuusage`...
Application 1: check `memoryusage` succeeded
Application 1: check `cpuusage` succeeded
Application 1: check `diskspace` succeeded
All done!
```

**Note:** if your output is diffrenet check your ssh connection to this server and make sure you did the installtion right

now when you reload the home page you will find the status changed to `3 Success` which it means we did all 3 checks and it works fine like image below

<img src="https://raw.githubusercontent.com/ahmedash95/server-monitor/master/storage/images/home_after_run_checks.png">

now if one of the checks faild like cpu usage you will find the stauts like below image

<img src="https://raw.githubusercontent.com/ahmedash95/server-monitor/master/storage/images/home_with_server_with_one_failed_status.png">

click on the show button to know which check is failed and see the output like below

<img src="https://raw.githubusercontent.com/ahmedash95/server-monitor/master/storage/images/show_server_status.png">


## Changelog

Please see [CHANGELOG](CHANGELOG.md) for more information what has changed recently.

## Testing

...TODO

## Contributing

Please see [CONTRIBUTING](CONTRIBUTING.md) for details.

## Security

If you discover any security related issues, please email ahmed29329@gmail.com instead of using the issue tracker.

## Credits

- [Ahmed Ashraf](https://github.com/ahmedash95)
- [All Contributors](../../contributors)

The code to execute commands on a remote server was copied from [Envoy](https://github.com/laravel/envoy).

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.
